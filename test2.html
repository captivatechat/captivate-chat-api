<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Captivate Chat API Test</title>
</head>

<body>
  <h1>Captivate Chat API Test</h1>
  <script src="./dist/captivate-chat-api.js"></script>
  <script>

    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    // Replace with your actual API key

    const gFredApiKey = '4f9069aa-41cb-11ee-a60d-325096b39f47';
    const xootsKey = 'e454a7a0-385a-11ef-a1b7-2db251afb54c';
    const stgKey = 'e7b8c3f2-98da-4c1b-b6f4-2a3d7e5f9c81';
    //const euBotApiKey = '02WJ8YW-X88MG02-KP1RJPY-5DSGGJR';
    const key = 'NP8D72V-J6G4BAT-QV8XDMQ-9VVZYEV';
    

    const testCaptivateAPI = async () => {
      // Create an instance of CaptivateChatAPI
      //const euBot = new CaptivateChatAPI(euBotApiKey, 'prod');
      //const gFred = new CaptivateChatAPI(stgKey, 'prod');
      //const euBot = new CaptivateChatAPI("C5HXEEQ-Y4H4XN7-MQB91CJ-VX75B2S-", "prod");

      //const gFred = new CaptivateChatAPI("e7b8c3f2-98da-4c1b-b6f4-2a3d7e5f9c81", "prod");
      //const mae = new CaptivateChatAPI("0J10E74-S44M589-NJZBSB2-EW2DC0X", 'prod')

      const hikma = new CaptivateChatAPI("04KNKV0-HFN4RM0-GECQY9Q-Q33SJZF", "dev");
    
      try {
        // Connect to the WebSocket server
        await hikma.connect();

        let conv = await hikma.createConversation('testxczvczxwaasdsayn1vz59', { firstName: 'Lance', lastName: 'safa', email: 'asdaf@gmail.com' }, {}, 'bot-first');
        
        await delay(2000);

        conv.onMessage((message, type) => {
          console.log(message);
        });

        conv.onActionReceived((actions) => {
          console.log(`Action`, actions);
        });

        conv.sendMessage('generate me a course on adobe firefly');




        // let convs = await mae.getUserConversations('66c46158e84e63012f00800c');

        //console.log(await convs[0].getTranscript());

        //let conv = await mae.createConversation('user152', { firstName: 'Lance', lastName: 'safa', email: 'asdaf@gmail.com' }, { course_id: '6781154966bddeac9f8c2d601', user_level: 'Novice' }, 'bot-first');
        //await delay(5000);
        //conv.sendMessage('where is canada located');
        //let conv = gFred.getConversation('679891f940bac411cba536e4_95699660-e93f-467f-bcb5-890fd944c372');
        //await conv.sendAction('setMode', { mode: 'dbFred' });
        //await gFred.connect();

        /*  try {
            await euBot.connect();
          } catch (err) {
            console.log('eu bot deliberately has an error but gfred should still be able to work once the await is done ')
          }*/
        //let users = await gFred.getUserConversations('6644a5e15cb441cc680d20d2');
        // let usersRegulation = await euBot.getUserConversations('679891f940bac411cba536e4');
        /*
          let conv = await mae.createConversation('usesr12341', { firstName: 'Lance', lastName: 'safa', email: 'asdaf@gmail.com' }, { course_id: '6781154966bddeac9f8c2d601', user_level: 'Novice' }, 'user-first');
          conv.onMessage((message, type) => {
            console.log(message);
          });
  */
        // conv.sendMessage('where is canada located');
        //console.log(users);
        //let conv = await euBot.createConversation('mae', { firstName: 'Lance', lastName: 'safa', email: 'asdaf@gmail.com' }, { course_id: '6781154966bddeac9f8c2d601', user_level: 'Novice' }, 'bot-first');

        //let c = mae.getConversation('6644a5e15cb441cc680d20d2');
        //  let t = await c.getTranscript();

        //  console.log(usersRegulation);
        /*await gFred.connect();
        const conversations = [
          ...(await euBot.getUserConversations('6582549cf3e9aa11f06c63ce')),
          ...(await gFred.getUserConversations('6582549cf3e9aa11f06c63ce'))
        ];
*/
        //console.log(conversations);
        //console.log(transcript);
        //console.log('WebSocket connected');

        //await captivateAPI.deleteUserConversations('lance_file_upload_test');
        // let conv = await captivateAPI.getUserConversations('lance_file_upload_test_a191be7d-1af2-4e58-9a9a-11e1b712d976');
        // let conv = await captivateAPI.getConversation('delete_convo_test_79a2a4f6-7519-438e-8fb9-f67df1023424');
        // console.log(await conv.getTranscript());

        // console.log(conv);

        //let conv = await mae.getConversation('66c46158e84e63012f00800c_b6e80524-8fb0-4fe8-a722-c9688a702120');
        //console.log('trans',await conv.getTranscript());
        // conv.delete();
        //let conv = await mae.createConversation('679891f940bac411cba536e4', { firstName: 'Lance', lastName: 'safa', email: 'asdaf@gmail.com' }, { course_id: '6781154966bddeac9f8c2d601', user_level: 'Novice' }, 'bot-first');

        //let conv = await captivateAPI.getConversation('lance_catcher_two_9bac9928-a1d8-4ab3-9ae4-bd8944a862cf');
        //await conv.delete();
        //let conv = await captivateAPI.getConversation('lance_catcher_two_602dd1f8-d932-4b13-8c33-162d7dfb929d');
        //let conv = await captivateAPI.getConversation('lance_catcher_two_69dc2cca-a669-43d1-a495-fce7d8f7f453');

        //console.log(users);

        //captivateAPI.deleteUserConversations('6582549cf3e9aa11f06c63ce');
        //console.log(await captivateAPI.getUserConversations('lance_catcher_two'))
        //console.log(users);

        /*
          
        
                conv.onActionReceived((actions) => {
                  console.log(`Action`, actions);
                });
                //await delay(2000);
                //conv.sendMessage('what is BSI ');
                //await delay(2000);
                /*conv.sendMessage({
                  type: 'files',
                  files: [
                    {
                      "type": "application/pdf",
                      "filename": 'myfile.pdf',
                      "filename2": 'real.pdf'
                    }
                  ]
                });
                await delay(2000);
                conv.setMetadata({ "conversation_title": "HoolahHoop" });
                */
        //await conv.sendAction('sendEmail', { email: 'delvallelance@gmail.com', message: 'You are fired' });
        //console.log(await conv.getTranscript());
        //console.log(conv.getConversationId());

        //let metadata_set = await conv.setMetadata({ mode2: 'dbfredPlainV2' });
        //console.log('the metadata_set:', metadata_set);
        //await delay(5000);
        //console.log(await conv.getTranscript());
        /*  conv.sendMessage('what is the updated EU regulation?');
          setTimeout(async () => {
            conv.sendAction('setMode', { mode: 'dbFred' });
            console.log('set Action DB Fred Sent');
          }, 5000);
          */
        //conv.sendMessage('what is the updated EU regulation?');
        //let metadata_get = await conv.getMetadata();

        // console.log('the metadata_get:', metadata_get);

        /*
         setTimeout(async () => {
           // await conv.setMetadata({ anoter: 'test' });
           metadata = await conv.getMetadata();
           console.log('the metadata:', metadata);
         }, 10000);
         */




        // Create a new conversation
        //const conversations = await captivateAPI.getUserConversations('aidan');

        //console.log(captivateAPI.getConversation(list[0]))

        /*
        setTimeout(async () => {
          conversation.setMetadata({ test1: 'hi i am metadata' });
          console.log("Start delay");
          setTimeout(async () => {
            console.log("This message appears after 5 seconds");
            let metadata = await conversation.getMetadata();
            console.log(metadata);
          }, 5000);
        }, 2000);
  */


        // console.log('Conversation started:', conversation.getConversationId());
        //  document.body.innerHTML += `<p>Conversation ID: ${conversation.getConversationId()}</p>`;
      } catch (error) {
        console.error('Error in CaptivateChatAPI:', error);
        document.body.innerHTML += `<p style="color: red;">Error: ${error.message}</p>`;
      }
    };

    // Run the function on page load
    testCaptivateAPI();
  </script>
</body>

</html>