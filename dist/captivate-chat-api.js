!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i=t();for(var n in i)("object"==typeof exports?exports:e)[n]=i[n]}}(this,(()=>(()=>{"use strict";var e={86:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CaptivateChatAPI=t.captivateLogger=void 0;const o=i(52);let s;if("undefined"!=typeof window&&window.WebSocket)s=window.WebSocket;else if(void 0!==i.g&&i.g.WebSocket)s=i.g.WebSocket;else try{s=i(591)}catch(e){throw new Error("WebSocket not available in this environment and ws module could not be loaded")}function r(e){return new Proxy(e,{get(e,t,i){const o=e[t];return"function"!=typeof o||["isSocketActive","connect","reconnect","getSocket","getConversationId"].includes(t)?o:function(...i){return n(this,void 0,void 0,(function*(){if("function"==typeof e.isSocketActive&&!e.isSocketActive())try{if("function"!=typeof e.reconnect)throw new Error("Reconnect method not available");yield e.reconnect()}catch(e){throw new Error(`Socket reconnection failed. Cannot execute ${String(t)}: ${e.message}`)}return o.apply(e,i)}))}}})}let a=!1;const c={log:console.log,warn:console.warn,error:console.error};t.captivateLogger={log:(...e)=>{a&&c.log("[CaptivateChatAPI]",...e)},warn:(...e)=>{c.warn("[CaptivateChatAPI]",...e)},error:(...e)=>{c.error("[CaptivateChatAPI]",...e)}};class d{static setDebugMode(e){a=e}static getDebugMode(){return a}constructor(e,i="prod"){this.socketId=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.apiKey=e,this.mode=i,this.url="prod"===this.mode?`wss://channel.wss.captivatechat.ai/dev?apiKey=${e}`:`wss://channel-dev.wss.captivatechat.ai/dev?apiKey=${e}`,this.socket=null,this.conversations=new Map,t.captivateLogger.log("CaptivateChatAPI: Using HTTP for sending messages and WebSocket for receiving real-time updates.")}_send(e){return n(this,void 0,void 0,(function*(){if(!this.apiKey)throw new Error("API key is required for HTTP communication");const i=("prod"===this.mode?"https://channel.prod.captivat.io":"https://channel.dev.captivat.io")+"/api/custom-channel/sockets/message",n=Object.assign(Object.assign({},e),{event:Object.assign(Object.assign({},e.event),{socket_id:this.socketId})});try{const e=yield fetch(i,{method:"POST",headers:{"x-api-key":this.apiKey,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(n)});if(!e.ok)throw new Error(`HTTP request failed: ${e.status} ${e.statusText}`);const o=e.headers.get("content-type");let s;if(o&&o.includes("application/json"))s=yield e.json();else{const i=yield e.text();t.captivateLogger.log("Server returned plain text:",i),s={status:"success",message:i,event:{event_payload:{conversation_id:null}}}}return t.captivateLogger.log("Message received from server via HTTP:",s),s}catch(e){throw console.error("HTTP request failed:",e),new Error(`Failed to send message via HTTP: ${e instanceof Error?e.message:"Unknown error"}`)}}))}connect(){return n(this,void 0,void 0,(function*(){return new Promise(((e,i)=>{try{this.socket=new s(this.url);const n=setTimeout((()=>{i(new Error("Connection timeout: socket_connected not received"))}),1e4);this.socket.onopen=()=>{},this.socket.onmessage=i=>{var o,s;try{const r=JSON.parse(i.data.toString());"socket_connected"===(null===(o=r.event)||void 0===o?void 0:o.event_type)&&(this.socketId=(null===(s=r.event.event_payload)||void 0===s?void 0:s.socket_id)||null,t.captivateLogger.log("Socket connected with ID:",this.socketId),clearTimeout(n),e())}catch(e){console.error("Error parsing message:",e)}},this.socket.onerror=e=>{console.error("WebSocket Error:",e.message||e),clearTimeout(n),i(new Error(e.message||"WebSocket error"))},this.socket.onclose=e=>{1e3!==e.code&&setTimeout((()=>this.connect()),3e3)}}catch(e){i(e)}}))}))}createConversation(e){return n(this,arguments,void 0,(function*(e,i={},s={},a="bot-first",c={}){return new Promise(((d,l)=>n(this,void 0,void 0,(function*(){var n;try{const h=Object.assign({},s);c&&(h.private=c);const v=e=>{var i,n,s,c;try{t.captivateLogger.log("messagereceived:",e.data.toString());const h=JSON.parse(e.data.toString());if("conversation_start_success"===(null===(i=h.event)||void 0===i?void 0:i.event_type)){const e=null===(n=h.event.event_payload)||void 0===n?void 0:n.conversation_id;if(!e)return null===(s=this.socket)||void 0===s||s.removeEventListener("message",v),void l(new Error("No conversation_id received in WebSocket response"));null===(c=this.socket)||void 0===c||c.removeEventListener("message",v);const t=r(new o.Conversation(e,this.socket,{},this.apiKey,this.mode,this.socketId));this.conversations.set(e,t),"bot-first"===a?t.sendMessage({type:"text",text:""}).then((()=>d(t))).catch(l):d(t)}}catch(e){console.error("Error processing message:",e)}};null===(n=this.socket)||void 0===n||n.addEventListener("message",v),setTimeout((()=>{var e;null===(e=this.socket)||void 0===e||e.removeEventListener("message",v),l(new Error("Timeout: No conversation_start_success received from WebSocket"))}),1e4),yield this._send({action:"sendMessage",event:{event_type:"conversation_start",event_payload:{userId:e,userBasicInfo:i,metadata:h}}})}catch(e){l(e)}}))))}))}getConversation(e){let t=this.conversations.get(e);if(!t){if(null===this.socket)throw console.error("Socket is not initialized"),new Error("WebSocket connection not established");t=r(new o.Conversation(e,this.socket,{},this.apiKey,this.mode,this.socketId)),this.conversations.set(e,t)}return null==t||t.restartListeners(),t}getUserConversations(e){return n(this,void 0,void 0,(function*(){var t;const i="string"==typeof e?{userId:e}:e,{userId:n,filter:s={},search:a={},pagination:c={},apiKeys:d}=i,l=[];let h;const v=s&&Object.keys(s).length>0||a&&Object.keys(a).length>0||c&&Object.keys(c).length>0||d&&Array.isArray(d)&&d.length>0;try{let e;if(v){const t={userId:n};s&&Object.keys(s).length>0&&(t.filter=s),a&&Object.keys(a).length>0&&(t.search=a),c&&Object.keys(c).length>0&&(t.pagination=c),d&&Array.isArray(d)&&d.length>0&&(t.apiKeys=d),e=yield this._send({action:"sendMessage",event:{event_type:"get_user_conversations_v2",event_payload:t}})}else e=yield this._send({action:"sendMessage",event:{event_type:"get_user_conversations",event_payload:{userId:n}}});const i=(null===(t=null==e?void 0:e.event)||void 0===t?void 0:t.event_payload)||e,p=(null==i?void 0:i.conversations)||[],u=null==i?void 0:i.pagination;for(const e of p){const{conversation_id:t,metadata:i,apiKey:n}=e;null!==this.socket&&l.push(r(new o.Conversation(t,this.socket,i,n||this.apiKey,this.mode,this.socketId)))}return u&&(h=u),{conversations:l,pagination:h}}catch(e){throw e}}))}deleteUserConversations(e){return n(this,arguments,void 0,(function*(e,i={}){if(!e)throw new Error("User ID must be provided.");const{softDelete:n=!0}=i,o={action:"sendMessage",event:{event_type:"delete_user_conversations",event_payload:{userId:e,softdelete:n}}},s=yield this._send(o);t.captivateLogger.log(`User conversations ${n?"soft":"hard"} delete confirmed via HTTP response:`,s)}))}getSocket(){return this.socket}getSocketId(){return this.socketId}isSocketActive(){return!!this.socket&&this.socket.readyState===s.OPEN}reconnect(){return n(this,void 0,void 0,(function*(){if(this.reconnectAttempts>=this.maxReconnectAttempts)throw new Error(`Max reconnection attempts (${this.maxReconnectAttempts}) reached`);this.reconnectAttempts++;try{yield this.connect(),this.reconnectAttempts=0}catch(e){if(console.error(`Reconnection attempt ${this.reconnectAttempts} failed:`,e),this.reconnectAttempts<this.maxReconnectAttempts)return yield new Promise((e=>setTimeout(e,this.reconnectDelay))),this.reconnect();throw e}}))}static create(e){return n(this,arguments,void 0,(function*(e,t="prod"){const i=new d(e,t);return yield i.connect(),r(i)}))}}t.CaptivateChatAPI=d},67:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CaptivateChatFileManager=void 0;class n{constructor(e,t,i){this.type="files",this.files=[{filename:t.metadata.originalFileName,type:i,file:e,textContent:t}]}static create(e){return i(this,void 0,void 0,(function*(){const t=e.file,i=void 0===e.storage||e.storage;if(!1===i&&!e.url)throw new Error("URL is required when storage is false for sendMessage compatibility");const o=e.fileName||(t instanceof File?t.name:`attachment_${Date.now()}`),s=e.fileType||(t instanceof File?t.type:t.type||"application/octet-stream"),r=yield n.convertFileToText(t,o,!0,i,e.apiKey,e.conversationId),a=new n(t,{type:"file_content",text:r.text,metadata:{source:"file_attachment",originalFileName:o,storageType:"direct"}},s);return i&&r.storageInfo&&(a.files[0].storage=r.storageInfo),!1===i&&e.url&&(a.files[0].url=e.url),n.createProxy(a)}))}getFirstFile(){return this.files[0]}getFilename(){var e;return null===(e=this.files[0])||void 0===e?void 0:e.filename}getTextContent(){var e,t;return(null===(t=null===(e=this.files[0])||void 0===e?void 0:e.textContent)||void 0===t?void 0:t.text)||""}getFileType(){var e;return null===(e=this.files[0])||void 0===e?void 0:e.type}toFilesArray(){return this.files}*[Symbol.iterator](){yield*this.files}get[Symbol.toStringTag](){return"Array"}get length(){return this.files.length}refreshSecureUrl(){return i(this,arguments,void 0,(function*(e=7200){var t;const i=this.files[0];if(i&&(null===(t=i.storage)||void 0===t?void 0:t.fileKey))return yield n.getSecureFileUrl(i.storage.fileKey,e)}))}static createProxy(e){return new Proxy(e,{get:(e,t)=>t===Symbol.iterator||"length"===t||"number"==typeof t?e.files[t]:e[t]})}static createFile(e){return i(this,void 0,void 0,(function*(){return(yield n.create({file:e.file,fileName:e.fileName,fileType:e.fileType,storage:e.storage,url:e.url,apiKey:e.apiKey,conversationId:e.conversationId})).getFirstFile()}))}static createMultiple(e){return i(this,void 0,void 0,(function*(){const t=void 0===e.storage||e.storage;if(!1===t&&(!e.urls||e.urls.length!==e.files.length))throw new Error("URLs array is required when storage is false and must match the number of files");const i=e.files,o=(yield Promise.all(i.map(((i,o)=>n.create({file:i,storage:t,url:!1===t?e.urls[o]:void 0,apiKey:e.apiKey,conversationId:e.conversationId}))))).flatMap((e=>e.files)),s=new n(i[0],{type:"file_content",text:"",metadata:{source:"file_attachment",originalFileName:"multiple_files",storageType:"direct"}},"application/octet-stream");return s.files=o,n.createProxy(s)}))}static getSecureFileUrl(e){return i(this,arguments,void 0,(function*(e,t=7200){const i=n.PRESIGNED_URL_API_URL;try{const n=yield fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileKey:e,expiresIn:t})});if(!n.ok){const e=yield n.json().catch((()=>({})));throw new Error(`Secure URL generation failed: ${n.status} ${n.statusText}. ${e.error||""}`)}const o=yield n.json();if(!o.success)throw new Error(`Secure URL generation failed: ${o.error||"Unknown error"}`);return o.presignedUrl||""}catch(e){if(e.message.includes("Secure URL generation failed"))throw e;throw new Error(`Failed to generate secure URL: ${e.message}`)}}))}static setTimeToLive(e,t,o){return i(this,void 0,void 0,(function*(){if(!e)throw new Error("API key is required");if(!t)throw new Error("Conversation ID is required");if("number"!=typeof o||o<=0||!Number.isInteger(o))throw new Error("Days must be a positive integer.");const i=`${e}/${t}`,s=n.PATH_TTL_API_URL;try{const t=yield fetch(s,{method:"POST",headers:{"x-api-key":e,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({path:i,days:o})});if(!t.ok){const e=yield t.json().catch((()=>({})));throw new Error(`TTL update failed: ${t.status} ${t.statusText}. ${e.error||""}`)}const n=yield t.json().catch((()=>({status:"success"})));if(!1===n.success)throw new Error(`TTL update failed: ${n.error||"Unknown error"}`)}catch(e){if(e.message.includes("TTL update failed"))throw e;throw new Error(`Failed to set path time-to-live: ${e.message}`)}}))}static convertFileToText(e,t,o,s,r,a){return i(this,void 0,void 0,(function*(){const i=n.FILE_TO_TEXT_API_URL,c=new FormData;if(c.append("file",e,t),c.append("includeMetadata",o.toString()),c.append("storage",s.toString()),r&&a){const e=`${r}/${a}`;c.append("path",e)}try{const e=yield fetch(i,{method:"POST",body:c});if(!e.ok){const t=yield e.json().catch((()=>({})));throw new Error(`File conversion failed: ${e.status} ${e.statusText}. ${t.error||""}`)}const t=yield e.json();if(!t.success)throw new Error(`File conversion failed: ${t.error||"Unknown error"}`);return{text:t.text||"",storageInfo:s?{fileKey:t.fileKey,presignedUrl:t.presignedUrl,expiresIn:t.expiresIn,fileSize:t.fileSize,processingTime:t.processingTime}:void 0}}catch(e){if(e.message.includes("File conversion failed"))throw e;throw new Error(`Failed to convert file to text: ${e.message}`)}}))}}t.CaptivateChatFileManager=n,n.FILE_TO_TEXT_API_URL="https://file-to-text.prod.captivat.io/api/file-to-text",n.PRESIGNED_URL_API_URL="https://file-to-text.prod.captivat.io/api/presigned-url",n.PATH_TTL_API_URL="https://file-to-text.prod.captivat.io/api/path-ttl"},629:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.CaptivateChatManager=void 0;const s=i(86),r=i(52);class a{constructor(e,t="prod"){this.apiInstances={};for(const i of e)this.apiInstances[i]=new s.CaptivateChatAPI(i,t)}static create(e){return n(this,arguments,void 0,(function*(e,t="prod"){const i=Object.create(a.prototype);i.apiInstances={};for(const n of e)i.apiInstances[n]=yield s.CaptivateChatAPI.create(n,t);return i}))}connectAll(){return n(this,void 0,void 0,(function*(){yield Promise.all(Object.values(this.apiInstances).map((e=>e.connect())))}))}getUserConversations(e){return n(this,void 0,void 0,(function*(){const t=e.apiKeys||Object.keys(this.apiInstances),i=this.apiInstances[t[0]],{apiKeys:n}=e,s=o(e,["apiKeys"]),a=yield i.getUserConversations(Object.assign(Object.assign({},s),{apiKeys:t}));return{conversations:a.conversations.map((e=>{const t=e.apiKey,i=this.apiInstances[t];if(!i)throw new Error(`No CaptivateChatAPI instance for apiKey: ${t}`);if(!i.getSocket())throw new Error(`WebSocket not initialized for apiKey: ${t}`);return new r.Conversation(e.conversationId,i.getSocket(),e.metadata,t)})),pagination:a.pagination}}))}getApiInstance(e){return this.apiInstances[e]}}t.CaptivateChatManager=a},52:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Conversation=void 0;const o=i(67),s=i(86);t.Conversation=class{constructor(e,t,i,s,r,a){this.socketId=null,this.apiKey=s||"",this.conversationId=e,this.socket=t,this.metadata=i||{},this.listeners=new Map,this.mode=r||"prod",this.socketId=a||null,this.socket&&(this.socket.onmessage=this.handleMessage.bind(this)),this.apiKey||console.warn("API key is required for HTTP communication. Some features may not work properly."),this.fileManager={create:e=>n(this,void 0,void 0,(function*(){return o.CaptivateChatFileManager.create({file:e.file,fileName:e.fileName,fileType:e.fileType,storage:e.storage,url:e.url,apiKey:this.apiKey,conversationId:this.conversationId})})),createFile:e=>n(this,void 0,void 0,(function*(){return o.CaptivateChatFileManager.createFile({file:e.file,fileName:e.fileName,fileType:e.fileType,storage:e.storage,url:e.url,apiKey:this.apiKey,conversationId:this.conversationId})})),createMultiple:e=>n(this,void 0,void 0,(function*(){return o.CaptivateChatFileManager.createMultiple({files:e.files,storage:e.storage,urls:e.urls,apiKey:this.apiKey,conversationId:this.conversationId})}))}}handleMessage(e){var t,i;const n=JSON.parse(e.data),o=null===(t=n.event)||void 0===t?void 0:t.event_type;if(o&&this.listeners.has(o)){const e=n.event.event_payload;null===(i=this.listeners.get(o))||void 0===i||i.forEach((t=>t(e)))}}restartListeners(){this.socket.onmessage=this.handleMessage.bind(this)}addListener(e,t){var i;this.restartListeners(),this.listeners.has(e)||this.listeners.set(e,[]),null===(i=this.listeners.get(e))||void 0===i||i.push(t)}onMessage(e){this.addListener("bot_message",(t=>e(t.content,"ai_agent"))),this.addListener("livechat_message",(t=>e(t.content,"human_agent"))),this.addListener("general_error",(t=>n(this,void 0,void 0,(function*(){if(413===t.error_code&&t.message_link)try{const i=yield fetch(t.message_link,{method:"GET",headers:{"x-api-key":this.apiKey,Accept:"application/json"}});if(!i.ok)throw new Error(`Failed to fetch large message: ${i.status} ${i.statusText}`);const n=yield i.json();e(n.botMessage.content,"ai_agent")}catch(t){console.error("Error fetching large message:",t),e(`[Error fetching large message: ${t.message}]`,"error")}else e(`[Error: ${t.error_desc||"Unknown error"}]`,"error")}))))}onActionReceived(e){this.addListener("action",(t=>e(t.actions)))}onConversationUpdate(e){this.addListener("conversation_update",(t=>{e({type:t.type,conversationId:t.conversation_id,data:t.data})}))}onError(e){this.addListener("general_error",(t=>{e({conversationId:t.conversation_id,errorCode:t.error_code,errorDesc:t.error_desc})}))}sendMessage(e){return n(this,void 0,void 0,(function*(){return"string"==typeof e&&(e={type:"text",text:e}),this.sendPayload("user_message",{type:"message_create",client_msg_id:`unique-message-id-${Date.now()}`,conversation_id:this.conversationId,content:e})}))}setMetadata(e){return n(this,void 0,void 0,(function*(){if("object"!=typeof e||null===e)throw new Error("Metadata must be a non-null object.");const t={action:"sendMessage",event:{event_type:"metadata",event_payload:{metadata:e,client_msg_id:`metadata-${Date.now()}`,conversation_id:this.conversationId}}},i=yield this.sendPayloadViaHttp(t);s.captivateLogger.log("Metadata update confirmed via HTTP response:",i)}))}setPrivateMetadata(e){return n(this,void 0,void 0,(function*(){if("object"!=typeof e||null===e)throw new Error("Private metadata must be a non-null object.");return this.setMetadata({private:e})}))}setTimeToLive(e){return n(this,void 0,void 0,(function*(){yield o.CaptivateChatFileManager.setTimeToLive(this.apiKey,this.conversationId,e),yield this.setMetadata({timeToLive:e})}))}sendAction(e){return n(this,arguments,void 0,(function*(e,t={}){const i=yield this.sendPayload("action",{type:"normal",id:e,data:t,conversation_id:this.conversationId});s.captivateLogger.log("Action sent confirmed via HTTP response:",i)}))}getTranscript(){return n(this,void 0,void 0,(function*(){if(!this.apiKey)throw new Error("API key is required to fetch transcript via REST.");const e=`${this.getBaseUrl()}/api/transcript?conversation_id=${encodeURIComponent(this.conversationId)}`,t=yield fetch(e,{method:"GET",headers:{"x-api-key":this.apiKey,Accept:"application/json"}});if(!t.ok)throw new Error(`Failed to fetch transcript: ${t.status} ${t.statusText}`);const i=yield t.json();return yield this.refreshExpiredFileUrls(i.transcript)}))}refreshExpiredFileUrls(e){return n(this,void 0,void 0,(function*(){const t=Math.floor(Date.now()/1e3);return yield Promise.all(e.map((e=>n(this,void 0,void 0,(function*(){if(!e.files||0===e.files.length)return e;const i=yield Promise.all(e.files.map((e=>n(this,void 0,void 0,(function*(){if(!e.storage||!e.storage.fileKey)return e;try{if(e.storage.expiresIn-t<300){const i=yield o.CaptivateChatFileManager.getSecureFileUrl(e.storage.fileKey,7200);return Object.assign(Object.assign({},e),{storage:Object.assign(Object.assign({},e.storage),{presignedUrl:i,expiresIn:t+7200})})}return e}catch(t){return console.error(`Failed to refresh file ${e.filename}:`,t),e}})))));if(i.some(((t,i)=>t!==e.files[i])))try{const t=e.message_id||e.id;if(t){const n=e.content?Object.assign(Object.assign({},e.content),{files:i}):{text:e.text||"",files:i};yield this.editMessage(String(t),n)}}catch(e){console.error("Failed to push refreshed URLs via editMessage:",e)}return Object.assign(Object.assign({},e),{files:i})})))))}))}getMetadata(){return n(this,void 0,void 0,(function*(){const e={action:"sendMessage",event:{event_type:"metadata_request",event_payload:{conversation_id:this.conversationId}}},t=yield this.sendPayloadViaHttp(e);return s.captivateLogger.log("Metadata retrieved via HTTP response:",t),t.metadata||t}))}delete(){return n(this,arguments,void 0,(function*(e={}){const{softDelete:t=!0}=e,i={action:"sendMessage",event:{event_type:"delete_conversation",event_payload:{conversation_id:this.conversationId,softdelete:t}}},n=yield this.sendPayloadViaHttp(i);s.captivateLogger.log(`Conversation ${t?"soft":"hard"} delete confirmed via HTTP response:`,n)}))}editMessage(e,t){return n(this,void 0,void 0,(function*(){"string"==typeof t&&(t={type:"text",text:t});const i={action:"sendMessage",event:{event_type:"edit_message",event_payload:{type:"message_create",client_msg_id:`edit-message-id-${Date.now()}`,conversation_id:this.conversationId,message_id:e,content:t}}},n=yield this.sendPayloadViaHttp(i);s.captivateLogger.log("Message edit confirmed via HTTP response:",n)}))}sendPayload(e,t){return n(this,void 0,void 0,(function*(){const i={action:"sendMessage",event:{event_type:e,event_payload:t}};return this.sendPayloadViaHttp(i)}))}sendPayloadViaHttp(e){return n(this,void 0,void 0,(function*(){if(!this.apiKey)throw new Error("API key is required for HTTP communication");const t=`${this.getBaseUrl()}/api/custom-channel/sockets/message`,i=Object.assign(Object.assign({},e),{event:Object.assign(Object.assign({},e.event),{socket_id:this.socketId})});try{const e=yield fetch(t,{method:"POST",headers:{"x-api-key":this.apiKey,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(i)});if(!e.ok)throw new Error(`HTTP request failed: ${e.status} ${e.statusText}`);const n=e.headers.get("content-type");let o;if(n&&n.includes("application/json"))o=yield e.json();else{const t=yield e.text();s.captivateLogger.log("Server returned plain text:",t),o={status:"success",message:t}}return s.captivateLogger.log("Payload received from server via HTTP:",o),o}catch(e){throw console.error("HTTP request failed:",e),new Error(`Failed to send payload via HTTP: ${e instanceof Error?e.message:"Unknown error"}`)}}))}removeListener(e,t){const i=this.listeners.get(e);i&&this.listeners.set(e,i.filter((e=>e!==t)))}getBaseUrl(){return"prod"===this.mode?"https://channel.prod.captivat.io":"https://channel.dev.captivat.io"}getConversationId(){return this.conversationId}}},591:e=>{e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,i),s.exports}i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();var n={};return(()=>{var e=n;Object.defineProperty(e,"__esModule",{value:!0}),e.CaptivateChatFileManager=e.CaptivateChatManager=e.CaptivateChatAPI=void 0;const t=i(86);Object.defineProperty(e,"CaptivateChatAPI",{enumerable:!0,get:function(){return t.CaptivateChatAPI}});const o=i(629);Object.defineProperty(e,"CaptivateChatManager",{enumerable:!0,get:function(){return o.CaptivateChatManager}});const s=i(67);Object.defineProperty(e,"CaptivateChatFileManager",{enumerable:!0,get:function(){return s.CaptivateChatFileManager}}),"undefined"!=typeof window&&(window.CaptivateChatAPI=t.CaptivateChatAPI,window.CaptivateChatManager=o.CaptivateChatManager,window.CaptivateChatFileManager=s.CaptivateChatFileManager)})(),n})()));